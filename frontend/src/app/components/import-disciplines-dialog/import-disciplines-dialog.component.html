<div class="import-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon>upload_file</mat-icon>
      {{ 'TOURNAMENT_DETAIL.DISCIPLINES.IMPORT_TITLE' | translate }}
    </h2>
    <button mat-icon-button (click)="onCancel()" class="close-button">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    @if (!parsedImportData()) {
      <!-- File Upload Section -->
      @if (!selectedFile()) {
        <div class="upload-area"
             [class.drag-over]="dragOver()"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)">
          <mat-icon class="upload-icon">cloud_upload</mat-icon>
          <h3>{{ 'TOURNAMENT_DETAIL.DISCIPLINES.IMPORT_DRAG_DROP' | translate }}</h3>
          <p>{{ 'TOURNAMENT_DETAIL.DISCIPLINES.IMPORT_OR' | translate }}</p>
          <button mat-raised-button color="primary" (click)="fileInput.click()">
            <mat-icon>folder_open</mat-icon>
            {{ 'TOURNAMENT_DETAIL.DISCIPLINES.IMPORT_BROWSE' | translate }}
          </button>
          <input #fileInput
                 type="file"
                 accept=".csv,.xls,.xlsx,text/csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                 (change)="onFileSelected($event)"
                 hidden>
          <p class="file-info">{{ 'TOURNAMENT_DETAIL.DISCIPLINES.IMPORT_SUPPORTED' | translate }}</p>
        </div>
      } @else {
        <div class="file-preview">
          <mat-icon class="file-icon">description</mat-icon>
          <div class="file-details">
            <h3>{{ selectedFile()!.name }}</h3>
            <p>{{ formatFileSize(selectedFile()!.size) }}</p>
          </div>
          @if (!uploading()) {
            <button mat-icon-button color="warn" (click)="removeFile()" class="remove-button">
              <mat-icon>delete</mat-icon>
            </button>
          }
        </div>

        @if (uploading()) {
          <div class="upload-progress">
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
            <p>{{ 'TOURNAMENT_DETAIL.DISCIPLINES.IMPORT_PROCESSING' | translate }}</p>
          </div>
        }
      }

      @if (validationErrors()?.length  && validationErrors()!.length > 0) {
        <div class="validation-errors">
          <mat-expansion-panel class="error-panel">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon class="error-icon">error</mat-icon>
                <span>Validation Errors ({{ validationErrors()!.length }})</span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            
            <div class="error-content">
              <pre class="error-json">{{ validationErrors() | json }}</pre>
            </div>
          </mat-expansion-panel>
        </div>
      }
    } @else {
      <!-- Stepper Section -->
      <mat-stepper #stepper [linear]="false" class="discipline-stepper">
        @for (disciplineKey of disciplineKeys(); track disciplineKey) {
          <mat-step [label]="disciplineKey">
            <div class="discipline-content">
              <h3>{{ disciplineKey }}</h3>
              <div class="participants-list">
                @for (players of parsedImportData()![disciplineKey]; track $index; let i = $index) {
                  <div class="participant-entry">
                    <div class="entry-number">{{ i + 1 }}</div>
                    <div class="players">
                      @for (player of players; track $index) {
                        <div class="player-card">
                          <div class="player-name">{{ player.firstname }} {{ player.lastname }}</div>
                          <div class="player-details">
                            <span class="gender-badge">{{ player.gender }}</span>
                            @if (player.club) {
                              <span class="club-name">{{ player.club }}</span>
                            }
                          </div>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
            <div class="step-actions">
              <button mat-button matStepperPrevious [disabled]="stepper.selectedIndex === 0">
                <mat-icon>arrow_back</mat-icon>
                Previous
              </button>
              <button mat-button matStepperNext [disabled]="stepper.selectedIndex === disciplineKeys().length - 1">
                Next
                <mat-icon>arrow_forward</mat-icon>
              </button>
            </div>
          </mat-step>
        }
      </mat-stepper>
    }
  </mat-dialog-content>

  <mat-dialog-actions>
    <button mat-button (click)="onCancel()" [disabled]="uploading()">
      {{ 'COMMON.CANCEL' | translate }}
    </button>
    @if (!parsedImportData()) {
      <button mat-raised-button 
              color="primary" 
              (click)="onImport()"
              [disabled]="!selectedFile() || uploading()">
        <mat-icon>upload</mat-icon>
        {{ 'TOURNAMENT_DETAIL.DISCIPLINES.IMPORT_BUTTON' | translate }}
      </button>
    } @else {
      <button mat-raised-button 
              color="primary" 
              (click)="dialogRef.close(parsedImportData())">
        <mat-icon>check</mat-icon>
        Confirm Import
      </button>
    }
  </mat-dialog-actions>
</div>


